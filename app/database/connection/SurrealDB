<?php 
/**
 * A Class to connet to SurrealDB.
 *  
 * PHP version 8.2
 *
 * @version v0.0.1
 * @category Database
 * @package Elara
 * @license Public Domain
 * @author Tafhimul kabir <https://github.com/tafhimulkabir>
 * @link  
 * @since File available since Release of Elara v0.0.1
 * @copyright   
 **/

declare(strict_types=1);

namespace App\Database\Connection\SurrealDB;

// Prevent from directly accessing the file.
if (!defined('Elara')) {
    die(http_response_code(404));
    return;
}

/**
 * Short description for class
 *
 * Long description for class (if any)...
 *
 * @category Database
 * @package Elara
 * @license        
 * @since Class available since Release of Elara v0.0.1
 */
class SurrealDBConn 
{
    /**
     * 
     */
    private $db_host;
    private $db_port;
    private $db_usr;
    private $db_pass;
    private $db_name;

    /**
     * 
     */
    private $conn = false;
    private $result = [];
    private $connction = null;

    /**
     * 
     */
    private function __construct()
    {

    }

    /**
     * Connect
     */
    protected static function connect()
    {

    }

    /**
     * 
     */
    private function __distruct()
    {
      
    }
}



// Start SurreadlDB's server
// surreal start --log trace --user admin --pass password file:data.db
function _db($query){ 
    $headers = [
      'Content-Type:application/json',
      'ns:company',
      'db:company'
    ];
    $ch = curl_init("http://localhost:8000/sql");
    curl_setopt($ch, CURLOPT_TIMEOUT, 2); //timeout in seconds
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true); // Do not outout the response automatically on exec
    curl_setopt($ch, CURLOPT_POSTFIELDS, $query);
    curl_setopt($ch, CURLOPT_HTTPAUTH, CURLAUTH_BASIC);
    curl_setopt($ch, CURLOPT_USERPWD, 'admin:password');
    curl_setopt($ch, CURLOPT_HTTPHEADER, $headers);
    $response = curl_exec($ch); // ENTER
    curl_close($ch);
    $http_code = curl_getinfo($ch, CURLINFO_HTTP_CODE);
    if( ! $http_code ){ throw new Exception('timeout'); }
    $response = json_decode($response, true); // the response as assosiative array
    if( isset($response['code']) && $response['code'] != 200 ){ throw new Exception($response['information']); }
    return end($response);
  }
  
  // ##############################
  function _respond($message='', $status=200){
    http_response_code($status);
    header('Content-Type: application/json');
    $res = is_array($message) ? $message : ['info' => $message];
    echo json_encode($res);
    exit();
  }
  